<!DOCTYPE html>
<html lang="en">

<head>
    <title>Document</title>
</head>

<body>
    <div class="chart"></div>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <script>
        let data1 = [
            { "time": 1691335800, "open": 1.2737, "high": 1.27538, "low": 1.2737, "close": 1.27412 },
            { "time": 1691339400, "open": 1.27412, "high": 1.27546, "low": 1.27391, "close": 1.27532 },
            { "time": 1691343000, "open": 1.27532, "high": 1.27532, "low": 1.27454, "close": 1.27489, },
            { "time": 1691346600, "open": 1.27489, "high": 1.27612, "low": 1.2744, "close": 1.27586 },
            { "time": 1691350200, "open": 1.27586, "high": 1.27586, "low": 1.27376, "close": 1.27496 },
        ]

        let data2 = [
            { "time": 1691335800, "price": 1.27551 },
            { "time": 1691339400, "price": 1.27549 },
            { "time": 1691343000, "price": 1.27440 },
            { "time": 1691346600, "price": 1.27580 },
            { "time": 1691350200, "price": 1.27362 },
        ]

        const chart = LightweightCharts.createChart(document.querySelector('.chart'), { autoSize: true, height: 800 });
        const candleSeries = chart.addCandlestickSeries();
        candleSeries.applyOptions({
            priceFormat: {
                type: "price",
                precision: 5,
                minMove: 0.00001,
            },
        })
        candleSeries.setData(data1);

        class MyCustomRenderer {
            _data = null
            _options = null
            draw(target, priceConverter) {
                target.useBitmapCoordinateSpace(scope =>
                    this._draw(scope, priceConverter)
                )
            }
            update(data, options) {
                this._data = data
                this._options = options
            }
            _draw(scope, priceToCoordinate) {
                if (
                    this._data === null ||
                    this._data.bars.length === 0 ||
                    this._data.visibleRange === null ||
                    this._options === null
                ) return;

                const { context: ctx } = scope

                const bars = this._data.bars.map((bar) => {
                    const valueY = priceToCoordinate(bar.originalData.price) ?? 0

                    return { x: bar.x, y: valueY }
                })

                let timeScale = chart.timeScale()
                ctx.strokeStyle = this._data.color || '#f00'
                let visibleRange = this._data.visibleRange

                for (let i = visibleRange.from; i < visibleRange.to; i++) {
                    if (i - 1 < 0) continue

                    ctx.beginPath()
                    ctx.moveTo(bars[i].x, bars[i].y)
                    ctx.lineTo(bars[i - 1].x, bars[i - 1].y)
                    ctx.stroke()
                }
            }
        }

        class MyCustomSeries {
            _renderer = new MyCustomRenderer()
            renderer() {
                return this._renderer
            }
            update(data, seriesOptions) {
                this._renderer.update(data, seriesOptions)
            }
            priceValueBuilder(plotRow) {
                let type = plotRow.type

                let data = []
                for (const [key, value] of Object.entries(plotRow)) {
                    data.push(value)
                }

                return data
            }
            isWhitespace(data) {
                return false
            }
            defaultOptions() {
                return {
                    color: '#777',
                }
            }
        }

        const customSeriesInstance = new MyCustomSeries()

        const myCustomSeries = chart.addCustomSeries(customSeriesInstance, {})
        myCustomSeries.setData(data2)
    </script>
</body>

</html>